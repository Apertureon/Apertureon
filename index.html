<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Photography Work</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
<script src="imageList.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/imagesloaded/4.1.4/imagesloaded.pkgd.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<header>
    <h1>My Photography Work</h1>
    <p>Exploring the beauty in everyday life</p>
</header>
<div class="content">
    <section class="gallery">
        <!-- Photos will be dynamically added here -->
    </section>
    <section>
        <h2>About Me</h2>
        <p>I am a photography enthusiast. My equipment: Nikon Z6.</p>
    </section>
    <section>
        <h2>Contact</h2>
        <p>If you need to contact me, please email: example@email.com</p>
    </section>
</div>
<footer>
    <p>&copy; 2024 My Photography Work</p>
</footer>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const gallery = document.querySelector('.gallery');
    console.log("Gallery element selected:", gallery);

    let loadedImagesCount = 0;
    const totalImages = imageList.length;
    console.log("Total images to load:", totalImages);

    imageList.forEach((src, index) => {
        const photoDiv = document.createElement('div');
        photoDiv.className = 'photo';
        photoDiv.id = 'photo' + index;

        const img = document.createElement('img');
        img.src = src;
        img.alt = 'Photo ' + (index + 1);

        const detailsDiv = document.createElement('div');
        detailsDiv.className = 'details';
        detailsDiv.id = 'exif-data' + index;

        photoDiv.appendChild(img);
        photoDiv.appendChild(detailsDiv);
        gallery.appendChild(photoDiv);

        img.onload = function() {
            loadedImagesCount++;
            console.log(`Image loaded: ${src}, Total loaded: ${loadedImagesCount}`);

            // Load EXIF data
            EXIF.getData(img, function() {
                var aperture = EXIF.getTag(this, 'FNumber');
                var shutterSpeed = EXIF.getTag(this, 'ExposureTime');
                var iso = EXIF.getTag(this, 'ISOSpeedRatings');

                if (aperture || shutterSpeed || iso) {
                    detailsDiv.innerHTML = `Aperture: f/${aperture ? aperture.numerator / aperture.denominator : 'N/A'} | ` +
                                           `Shutter Speed: ${shutterSpeed ? shutterSpeed.numerator + '/' + shutterSpeed.denominator + ' sec' : 'N/A'} | ` +
                                           `ISO: ${iso || 'N/A'}`;
                    console.log(`EXIF data set for ${src}: Aperture=${aperture}, Shutter Speed=${shutterSpeed}, ISO=${iso}`);
                } else {
                    detailsDiv.innerHTML = "No EXIF Data found.";
                    console.log(`No EXIF data found for ${src}.`);
                }
            });

            // Once all images are loaded, adjust the row heights
            if (loadedImagesCount === totalImages) {
                console.log("All images loaded, adjusting row heights.");
                adjustRowHeights();
            }
        };

        // Ensure onload fires for cached images
        if (img.complete) {
            img.onload();
            console.log(`Cached image onload fired manually for ${src}.`);
        }
    });

    function adjustRowHeights() {
        let rows = [];
        let currentTopOffset = 0;
        const galleryWidth = gallery.clientWidth;
        const photos = Array.from(gallery.children);

        // Sort photos into rows based on their top offset
        photos.forEach(photo => {
            let rect = photo.getBoundingClientRect();
            if (rect.top !== currentTopOffset) {
                currentTopOffset = rect.top;
                rows.push([]);
            }
            rows[rows.length - 1].push(photo);
        });

        // Adjust each row's height based on the aspect ratio and the total width
        rows.forEach(row => {
            let minHeight = Math.min(...row.map(photo => photo.querySelector('img').naturalHeight));
            row.forEach(photo => {
                photo.style.height = `${minHeight}px`;
            });
        });
    }
});
</script>
</body>
</html>
